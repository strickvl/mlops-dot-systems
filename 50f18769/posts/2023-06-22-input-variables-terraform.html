<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex Strick van Linschoten">
<meta name="dcterms.date" content="2023-06-22">
<meta name="description" content="All the ways you can set input and local variables when using Terraform.">

<title>Alex Strick van Linschoten - Terraform Input Variables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script defer="" data-domain="mlops.systems" src="https://plausible.io/js/script.js"></script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Alex Strick van Linschoten - Terraform Input Variables">
<meta property="og:description" content="All the ways you can set input and local variables when using Terraform.">
<meta property="og:image" content="https://mlops.systems/posts/images/inputs-outputs-terraform.png">
<meta property="og:site-name" content="Alex Strick van Linschoten">
<meta property="og:image:height" content="400">
<meta property="og:image:width" content="400">
<meta name="twitter:title" content="Alex Strick van Linschoten - Terraform Input Variables">
<meta name="twitter:description" content="All the ways you can set input and local variables when using Terraform.">
<meta name="twitter:image" content="https://mlops.systems/posts/images/inputs-outputs-terraform.png">
<meta name="twitter:creator" content="@strickvl">
<meta name="twitter:image-height" content="400">
<meta name="twitter:image-width" content="400">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Alex Strick van Linschoten</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../til.html">
 <span class="menu-text">TIL</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/strickvl"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sigmoid.social/web/@alexstrick"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/strickvl"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://mlops.systems/index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Terraform Input Variables</h1>
                  <div>
        <div class="description">
          All the ways you can set input and local variables when using Terraform.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">terraform</div>
                <div class="quarto-category">devops</div>
                <div class="quarto-category">softwareengineering</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Alex Strick van Linschoten </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 22, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#variable-blocks" id="toc-variable-blocks" class="nav-link active" data-scroll-target="#variable-blocks">Variable blocks</a></li>
  <li><a href="#variables-passed-in-at-the-command-line" id="toc-variables-passed-in-at-the-command-line" class="nav-link" data-scroll-target="#variables-passed-in-at-the-command-line">Variables passed in at the command line</a></li>
  <li><a href="#variables-passed-in-with-files" id="toc-variables-passed-in-with-files" class="nav-link" data-scroll-target="#variables-passed-in-with-files">Variables passed in with files</a></li>
  <li><a href="#variables-passed-in-using-environment-variables" id="toc-variables-passed-in-using-environment-variables" class="nav-link" data-scroll-target="#variables-passed-in-using-environment-variables">Variables passed in using environment variables</a></li>
  <li><a href="#using-variables" id="toc-using-variables" class="nav-link" data-scroll-target="#using-variables">Using variables</a></li>
  <li><a href="#local-variables" id="toc-local-variables" class="nav-link" data-scroll-target="#local-variables">Local variables</a></li>
  <li><a href="#variable-precedence" id="toc-variable-precedence" class="nav-link" data-scroll-target="#variable-precedence">Variable Precedence</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>When working with Terraform code, there are ways to take in user input at the time when you are applying whatever you’ve defined. To take a perhaps needlessly simple example, you might write a definition that allows you to deploy a new S3 bucket but you probably wouldn’t want to hardcode the name of the new bucket; instead, you’d rather take that name at the point of deployment. So if we think of the terraform process as a big function call, our input variables are the inputs we pass into this function application.</p>
<p>There are three main ways that you’ll use and encounter input variables in HCL code.</p>
<ol type="1">
<li>variables passed in at the command line using <code>-var</code></li>
<li>variables defined in separate files either automatically parsed or passed in using the <code>-var-file</code> option at the command line</li>
<li>variables defined as environment variables</li>
</ol>
<p>The first two are fairly commonly used, especially during development / testing, but are not really a great idea if your aim is a production-grade setup. Let’s walk through them one by one, but first let’s look at the variable block itself in HCL.</p>
<section id="variable-blocks" class="level2">
<h2 class="anchored" data-anchor-id="variable-blocks">Variable blocks</h2>
<p>A variable block can look like this:</p>
<pre class="hcl"><code>variable "some_variable" {
  description = "This is where you describe the variable"
  type        = string
  default     = "ginger_cat"
  nullable    = false
  sensitive   = false
}</code></pre>
<p>Most of this is self-explanatory. You can also specify a <code>validation</code> value in which you can determine the appropriate or accepted values for the variable. If you set <code>sensitive</code> to true, then terraform will (mostly) keep the value out of any output printed in the terminal. The name for the variable should be unique within the module and the value of this variable must be a literal value; it cannot be the result of an expression. If you don’t specify a default value then on running <code>terraform apply</code> or <code>plan</code> you will be asked what value you want to use.</p>
<p>(There are also a limited handful of key words that are forbidden for use as names for the variable; you can look them up <a href="https://developer.hashicorp.com/terraform/language/values/variables#declaring-an-input-variable">in the docs</a>.)</p>
</section>
<section id="variables-passed-in-at-the-command-line" class="level2">
<h2 class="anchored" data-anchor-id="variables-passed-in-at-the-command-line">Variables passed in at the command line</h2>
<p>Instead of just waiting for the terraform CLI to ask you what values you want to assign to variables, you can pass them in at the command line. Your variables might live in a <code>variables.tf</code> file (or be located across your <code>.tf</code> files) but when you run <code>terraform apply</code> you can do so in the following way:</p>
<pre class="shell"><code>terraform apply -var="some_variable=black_cat"</code></pre>
<p>If you have multiple variables (as you are likely to have) then you can use the <code>-var</code> option multiple times.</p>
</section>
<section id="variables-passed-in-with-files" class="level2">
<h2 class="anchored" data-anchor-id="variables-passed-in-with-files">Variables passed in with files</h2>
<p>As you might imagine, this rapidly gets unwieldy so there is also a way to populate a whole file with the variable:value pairs. You can either explicitly specify a filename to use for those variables, or there are certain filenames that will be automatically be loaded in and parsed.</p>
<pre class="shell"><code># passing a file name explicitly
terraform apply -var-file="my_vals.tfvars"</code></pre>
<p>A file called <code>terraform.tfvars</code>, or <code>terraform.tfvars.json</code>, or any file ending in <code>.auto.tfvars</code> or <code>auto.tfvars.json</code> will all be loaded automatically without the need to explicitly pass them in at the command line.</p>
</section>
<section id="variables-passed-in-using-environment-variables" class="level2">
<h2 class="anchored" data-anchor-id="variables-passed-in-using-environment-variables">Variables passed in using environment variables</h2>
<p>Some situations require different approaches than populating a file or passing them in via the command line so terraform also checks any environment variable with the <code>TF_VAR_</code> prefix and imports those automatically. For example, we could run:</p>
<pre class="shell"><code>export TF_VAR_some_variable=white_cat</code></pre>
<p>And the <code>some_variable</code> variable would be populated with the <code>white_cat</code> value.</p>
</section>
<section id="using-variables" class="level2">
<h2 class="anchored" data-anchor-id="using-variables">Using variables</h2>
<p>You can use variables (to get their values) by using the <code>var.</code> prefix. For example, if I was defining an AWS S3 bucket and I wanted to use the value of the <code>some_variable</code> value for that bucket name, I could do something like this in my HCL definition:</p>
<pre class="hcl"><code>resource "aws_s3_bucket" "my_first_bucket" {
  bucket        = var.some_variable
}</code></pre>
</section>
<section id="local-variables" class="level2">
<h2 class="anchored" data-anchor-id="local-variables">Local variables</h2>
<p>Sometimes you want to define local variables that don’t need exposing as configurable parameters (as the input variables described above are). We have local variables for this, and you define them in their own block:</p>
<pre><code>locals {
  my_cat = "aria"
}</code></pre>
<p>The useful thing about local variables is that you <em>can</em> assign expressions as the values for these variables, or you can combine or otherwise transform things.</p>
<p>These local variables are accessible elsewhere with the <code>local.</code> prefix (e.g.&nbsp;in the above example, as <code>local.my_cat</code>)</p>
<p>You might want to use local variables where you have some particular expression that’s used multiple times in your file so you want to keep it <em>DRY</em> so you use a local variable. Similarly, if something is likely to be changed, you might want to make the change only in one place instead of multiple places. These are only available for use within the module where it is declared and can’t be overridden from the outside.</p>
</section>
<section id="variable-precedence" class="level2">
<h2 class="anchored" data-anchor-id="variable-precedence">Variable Precedence</h2>
<p>With all these different ways to pass in values for variables, how do you know which one gets chosen? There are precedence rules that determine which value is used. Variables are loaded in this order, and the last one seen is the one that is used:</p>
<ul>
<li>environment variables</li>
<li>the <code>terraform.tfvars</code> file</li>
<li>the <code>terraform.tfvars.json</code> file</li>
<li>any <code>….auto.tfvars</code> (or the <code>.json</code> equivalent) files</li>
<li>any <code>-var</code> and/or <code>-var-file</code> values set via the command line</li>
</ul>
<p>Nothing about using these variables is particularly difficult to understand, but it’s useful to have a sense of those precedence rules nonetheless, especially if you have the same variable defined in multiple places.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="strickvl/mlops-dot-systems" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>