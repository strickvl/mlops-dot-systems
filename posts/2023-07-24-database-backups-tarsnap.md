---
author: Alex Strick van Linschoten
categories:
  - databases
  - skillbuilding
  - softwareengineering
  - tools
  - miniproject
date: "2023-07-24"
description: "I added a cronjob to automate database backups for my MathsPrompt questions."
layout: post
title: "Automating database backups with Tarsnap"
toc: true
image: images/mathsprompt/database-backups-cover.png
include-before-body:
  '<script defer data-domain="mlops.systems"
  src="https://plausible.io/js/script.js"></script>'
comments:
  utterances:
    repo: strickvl/mlops-dot-systems
---

[Yesterday I wrote](https://mlops.systems/posts/2023-07-23-maths-prompt-rust-project.html) about [my MathsPrompt tool](https://github.com/strickvl/mathsprompt/) which serves up questions to help me practice new skills I'm learning as part of my mathematics degree. Today I realised that all the data (both autogenerated and copy-pasted) is being stored in my database and that I hadn't really given much thought yet to ensuring a long life for that data.

I put together a shell script that backs up my data to [Tarsnap](https://www.tarsnap.com/), my preferred cloud backup service for things like this. It has the tagline "online backups for the truly paranoid" and while it perhaps isn't the best choice for rich media like photos and videos, it's really great for compressible text data. I use it on all my personal cloud machines to painlessly back up critical files.

So my backup script goes as follows:

```shell
#!/bin/sh
pg_dump -U my_username -F t mathsprompt > /tmp/mathsprompt_backup.tar || exit 1
/usr/local/bin/tarsnap -c \
	-f "$(uname -n)-$(date +%Y-%m-%d_%H-%M-%S)-mathsprompt-db" \
	/tmp/mathsprompt_backup.tar 
rm /tmp/mathsprompt_backup.tar
```

Then I set up a [cronjob](https://en.wikipedia.org/wiki/Cron) to handle running this script every day at 5pm. Adding that was as simple as adding the following line (via `crontab -e`) to my previously configured jobs:

```
0 17 * * * path/to/tarsnap-db-backup.sh
```

There are fancier things I could do to backup this database, for instance [configuring a streaming backup](https://litestream.io) (a useful suggestion I learned about [here](https://blog.wesleyac.com/posts/how-i-run-my-servers)), but that'd be overkill for my particular scenario, I think.

Tarsnap is also sufficiently cheap that I don't need to worry about costs or using up too much space, but in the future I might consider doing some regular cleanup of really old database backups.