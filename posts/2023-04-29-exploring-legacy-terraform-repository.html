<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex Strick van Linschoten">
<meta name="dcterms.date" content="2023-04-29">
<meta name="description" content="Learn the essentials of working with Terraform as a beginner, including basic commands like init, plan, apply, and destroy. Gain insights into code structure, variables, outputs, and providers while exploring a new codebase.">

<title>Terraform for the Uninitiated: Demystifying Your First Codebase â€“ Alex Strick van Linschoten</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer="" data-domain="alexstrick.com" src="https://plausible.io/js/script.js"></script>


<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../styles/technical.css">
<meta property="og:title" content="Terraform for the Uninitiated: Demystifying Your First Codebase â€“ Alex Strick van Linschoten">
<meta property="og:description" content="Learn the essentials of working with Terraform as a beginner, including basic commands like init, plan, apply, and destroy. Gain insights into code structure, variables, outputs, and providers while exploring a new codebase.">
<meta property="og:image" content="https://alexstrick.com/posts/images/terraform-blog.png">
<meta property="og:site_name" content="Alex Strick van Linschoten">
<meta property="og:image:height" content="500">
<meta property="og:image:width" content="500">
<meta name="twitter:title" content="Terraform for the Uninitiated: Demystifying Your First Codebase â€“ Alex Strick van Linschoten">
<meta name="twitter:description" content="Learn the essentials of working with Terraform as a beginner, including basic commands like init, plan, apply, and destroy. Gain insights into code structure, variables, outputs, and providers while exploring a new codebase.">
<meta name="twitter:image" content="https://alexstrick.com/posts/images/terraform-blog.png">
<meta name="twitter:creator" content="@strickvl">
<meta name="twitter:image-height" content="500">
<meta name="twitter:image-width" content="500">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed technical-page quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Alex Strick van Linschoten</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../technical.html"> 
<span class="menu-text">Technical</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../personal.html"> 
<span class="menu-text">Personal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../all.html"> 
<span class="menu-text">All</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../til.html"> 
<span class="menu-text">TIL</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/strickvl"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sigmoid.social/web/@alexstrick"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/strickvl"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rss" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">RSS</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-rss">    
        <li>
    <a class="dropdown-item" href="../technical.xml">
 <span class="dropdown-text">Technical RSS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../personal.xml">
 <span class="dropdown-text">Personal RSS</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started">ğŸ Getting started</a></li>
  <li><a href="#places-to-look-first" id="toc-places-to-look-first" class="nav-link" data-scroll-target="#places-to-look-first">ğŸ‘€ Places to look first</a>
  <ul class="collapse">
  <li><a href="#start-at-the-root-modules" id="toc-start-at-the-root-modules" class="nav-link" data-scroll-target="#start-at-the-root-modules">ğŸ¬ Start at the root &amp; Modules</a></li>
  <li><a href="#finding-our-entrypoint" id="toc-finding-our-entrypoint" class="nav-link" data-scroll-target="#finding-our-entrypoint">ğŸšª Finding our entrypoint</a></li>
  <li><a href="#providers" id="toc-providers" class="nav-link" data-scroll-target="#providers">ğŸ¥ Providers</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">âœï¸ Variables</a></li>
  <li><a href="#finding-our-outputs" id="toc-finding-our-outputs" class="nav-link" data-scroll-target="#finding-our-outputs">ğŸ“¤ Finding our outputs</a></li>
  <li><a href="#data-blocks" id="toc-data-blocks" class="nav-link" data-scroll-target="#data-blocks">ğŸ§± Data blocks</a></li>
  </ul></li>
  <li><a href="#checks-and-balances" id="toc-checks-and-balances" class="nav-link" data-scroll-target="#checks-and-balances">ğŸ§ Checks and balances</a></li>
  <li><a href="#overview-tricks" id="toc-overview-tricks" class="nav-link" data-scroll-target="#overview-tricks">ğŸ—ºï¸ Overview tricks</a>
  <ul class="collapse">
  <li><a href="#listing-state" id="toc-listing-state" class="nav-link" data-scroll-target="#listing-state">ğŸ“¦ Listing State</a></li>
  <li><a href="#graphing-your-infrastructure" id="toc-graphing-your-infrastructure" class="nav-link" data-scroll-target="#graphing-your-infrastructure">ğŸ“ˆ Graphing your infrastructure</a></li>
  <li><a href="#auto-generated-deployment-documentation" id="toc-auto-generated-deployment-documentation" class="nav-link" data-scroll-target="#auto-generated-deployment-documentation">ğŸ“„ Auto-generated deployment documentation</a></li>
  </ul></li>
  <li><a href="#onwards" id="toc-onwards" class="nav-link" data-scroll-target="#onwards">Onwards!</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Terraform for the Uninitiated: Demystifying Your First Codebase</h1>
  <div class="quarto-categories">
    <div class="quarto-category">terraform</div>
    <div class="quarto-category">softwareengineering</div>
    <div class="quarto-category">devops</div>
  </div>
  </div>

<div>
  <div class="description">
    Learn the essentials of working with Terraform as a beginner, including basic commands like init, plan, apply, and destroy. Gain insights into code structure, variables, outputs, and providers while exploring a new codebase.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alex Strick van Linschoten </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 29, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Iâ€™ve taken on some different responsibilities at work and part of this involves me diving into a repository filled with Terraform HCL code. I have some idea of how Terraform works, how the declarative paradigm is different and how things connect to one another, but getting up to speed and effective in a somewhat complex codebase is the goal here so Iâ€™ll need more than just high-level talking points.</p>
<p>In this post, I share my journey of understanding and working with an existing Terraform codebase, focusing on initial exploration, key concepts, and useful commands. I start with an introduction to basic Terraform commands like init, plan, apply, and destroy. Then, I dive into the structure of a Terraform codebase, discussing root modules, entry points, providers, variables, outputs, and data blocks. I also cover validation and formatting commands, as well as tools to help visualize and document your infrastructure. This guide is ideal for those who, like me, are new to Terraform or tasked with diving into a complex codebase, providing a roadmap for learning and making changes effectively.</p>
<section id="getting-started" class="level1">
<h1>ğŸ Getting started</h1>
<p>At its most basic, Terraform is easy to use. A few commands will get you started in a practical sense with the new codebase.</p>
<ul>
<li><code>terraform init</code> â€” do this first. It downloads any information it needs about the providers (i.e.&nbsp;AWS or GCP or whatever) it needs to use for deploying infrastructure. This command doesnâ€™t deploy anything. It will also check whether the code all checks out and is â€˜soundâ€™.</li>
<li><code>terraform plan</code> â€” this is one way to see what infrastructure will be spun up as a consequence of running <code>terraform apply</code> (see below). It will come up with its plan for what will be deployed (by resolving or reading through all the code). There are options to export this plan as JSON and more, but to start with just the basic command will serve you well.</li>
<li><code>terraform apply</code> â€” This is the bread and butter of deploying infrastructure with Terraform. It will run <code>terraform plan</code> first, and then query you if you really want it to make whatever deployments and changes it says that are set to take place. The first time you run this command it might just be deploying infrastructure (if itâ€™s not relating to pre-existing infrastructure), but for other contexts it may not actually do anything since the infrastructure is already deployed. More on this later.</li>
<li><code>terraform destroy</code> â€” This is how you delete and destroy code deployed previously with terraform. Just like with <code>apply</code>, youâ€™ll get the <code>plan</code> output and a confirmation message to check that you actually want to remove this infrastructure. Remember that destroying your infrastructure will likely delete data as well, so <em>be careful</em> with this one.</li>
</ul>
<p>Armed with these basic commands, a good first place to start with a new codebase might just be <code>terraform plan</code>. It does nothing in terms of actually changing or deploying infrastructure and might give you a sense of whether things are already deployed or what would be deployed if nothing was already deployed.</p>
<p>In my case, the codebase involves several separate modules, none of which are deployed, so running <code>terraform plan</code> in one of these base folders tells me that 70 resources would be spun up and gives me specific details of those. This is somewhat useful, but itâ€™s still a bit high-level and doesnâ€™t help me really understand the codebase.</p>
<p>If you have the option, now might actually be the time to deploy that infrastructure. Potentially you could inspect some of it in the AWS console (or wherever itâ€™s deployed), comparing notes between the output of <code>terraform plan</code> or <code>apply</code> and what you see on the screen in front of you.</p>
<p>Note, too, that terraform CLI commands donâ€™t use double hyphens (<code>--</code>) but just single hyphens (<code>-</code>) which can be a bit confusing at first.</p>
</section>
<section id="places-to-look-first" class="level1">
<h1>ğŸ‘€ Places to look first</h1>
<p>These are some things to consider as you look through your code. Itâ€™s structured sequentially for the most part, i.e.&nbsp;youâ€™ll probably want to start at the entrypoint before you look at outputs.</p>
<section id="start-at-the-root-modules" class="level2">
<h2 class="anchored" data-anchor-id="start-at-the-root-modules">ğŸ¬ Start at the root &amp; Modules</h2>
<p>Most Terraform code is structured into modules, which are simply groups of multiple <code>.tf</code> and/or <code>.tf.json</code> files in the same directory. The root module is where youâ€™ll want to start, as specified <a href="https://developer.hashicorp.com/terraform/language/modules">in the docs</a>:</p>
<blockquote class="blockquote">
<p>â€œEvery Terraform configuration has at least one module, known as its root module, which consists of the resources defined in the .tf files in the main working directory.â€</p>
</blockquote>
<p>You can have child modules within that root module (i.e.&nbsp;local files that define other separate modules) or you can load modules from a registry (like the <a href="https://registry.terraform.io/browse/modules">Terraform Registry</a>).</p>
</section>
<section id="finding-our-entrypoint" class="level2">
<h2 class="anchored" data-anchor-id="finding-our-entrypoint">ğŸšª Finding our entrypoint</h2>
<p>Most root modules will have a <code>main.tf</code> which we can think of as the main entrypoint for the logic of the code. (Child modules can and will likely have their own set of <code>main.tf</code> as well as variable definitions (see below).)</p>
<p>I found it hard to reason about declarative code of the kind that you find in terraform codebases, because itâ€™s not simply a question of procedurally running through a series of steps one by one. The work that terraform is actually doing is resolving all the interconnections, dependencies and diffs between the entirety of the code all at once, so itâ€™s counterproductive to try to think of it as happening sequentially.</p>
</section>
<section id="providers" class="level2">
<h2 class="anchored" data-anchor-id="providers">ğŸ¥ Providers</h2>
<p>Youâ€™ll likely see some providers being defined in your <code>main.tf</code> file. These are the infrastructure providers that youâ€™re interfacing with when you run <code>apply</code> for your terraform code. The specific logic and definitions for those providers are what gets loaded when you initialise your repository with <code>terraform init</code>. These will look something like this:</p>
<pre class="hcl"><code>provider "kubernetes" {
        ...details go here...
}</code></pre>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">âœï¸ Variables</h2>
<p>Input variables are usually defined in a <code>variables.tf</code> file, which can specify their type, any tags needed to be applied as well as optional defaults. If you define them without any defaults, then running <code>terraform apply</code> will see you being queried about what the values for those variables should be.</p>
<p>You can pass them in via the command line, for example:</p>
<pre class="shell"><code>terraform apply -var "server_port=8080"</code></pre>
<p>With more than a few variables itâ€™s unwise to have that be the way you pass those values in, so you can also optionally set those variables using a <code>terraform.tfvars</code> file. This file is where youâ€™d set specific assignments and you can then pass that in via the command line explicitly or (if itâ€™s named <code>terraform.tfvars</code>) these will just get automatically loaded and applied.</p>
<pre class="shell"><code>terraform apply -var-file="testing.tfvars"</code></pre>
<p>To use these variables elsewhere in the code, simply reference the variable name after <code>var.</code>. For example, if your variable is called <code>server_port</code> as mentioned earlier, you would reference <code>var.server_port</code> when you wanted to access the value for that variable.</p>
<p>You can also specify and declare local variables (accessed through the <code>local.</code> prefix) by declaring a <code>locals</code> block within a specific file. For example:</p>
<pre class="hcl"><code>locals {
  service_name = "forum"
  owner        = "Community Team"
}</code></pre>
</section>
<section id="finding-our-outputs" class="level2">
<h2 class="anchored" data-anchor-id="finding-our-outputs">ğŸ“¤ Finding our outputs</h2>
<p>Outputs are values that will be printed in the console output at the end of whatever happens as part of <code>terraform apply</code>. They will also be accessible and available to you later on to query. For example, letâ€™s say you spin up an instance of a Linux machine somewhere. Youâ€™ll want to have the IP address of that machine if you want to SSH into it, so you could set that as one of the outputs. Most likely your terraform codebase will have some outputs, usually stored in an <code>outputs.tf</code> file that is pretty straightforward to read.</p>
</section>
<section id="data-blocks" class="level2">
<h2 class="anchored" data-anchor-id="data-blocks">ğŸ§± Data blocks</h2>
<p>Data blocks are special kinds of resource that allow you to access (read-only) information from some source. It is a way to query a providerâ€™s API for some data. Most providers expose various pieces of data, and these can range from simple things to IP address ranges or AMI IDs and so on. Even the current userâ€™s identity can be accessed through <code>data</code> blocks.</p>
<p>These are defined inside a <code>data</code> block. For example, if youâ€™re using the <code>aws</code> provider you could get the data for your default VPC with the following:</p>
<pre class="hcl"><code>data "aws_vpc" "default" {
    default = true
}</code></pre>
<p>Then to use that data elsewhere, you can just reference it using the <code>data.</code> prefix.</p>
</section>
</section>
<section id="checks-and-balances" class="level1">
<h1>ğŸ§ Checks and balances</h1>
<p>The above pointers should give you most of what you need to dive into your actual codebase. Specifics will vary based on the specific providers used and the infrastructure types being defined, but that will relate to your specific use case or application. Hopefully youâ€™ll have a sense of that prior to approaching the codebase and those two things together will allow you to do a bit of detective work as to whatâ€™s going on.</p>
<p>At a certain point youâ€™ll maybe start changing things. At that point itâ€™s worth learning two extra commands that will check that what youâ€™re writing is proper HCL.</p>
<ul>
<li><code>terraform fmt</code> â€” This is the same command as is used in Golang to format the files and ensure that everything follows the same canonical format and style. Running the command will auto-format the spacing and potentially make many other minor tweaks. Get into the habit of running this before you commit any updates to your repository.</li>
<li><code>terraform validate</code> â€” This checks that your local files are all valid and donâ€™t violate any syntax or consistency rules. Itâ€™s something that will also happen when you run <code>terraform apply</code> or <code>terraform plan</code> but sometimes you might just want to validate your local code.</li>
</ul>
</section>
<section id="overview-tricks" class="level1">
<h1>ğŸ—ºï¸ Overview tricks</h1>
<p>There are some other commands and tools that can help you if youâ€™re dealing with a particularly unwieldy codebase, listed in no particular order.</p>
<section id="listing-state" class="level2">
<h2 class="anchored" data-anchor-id="listing-state">ğŸ“¦ Listing State</h2>
<p>The <a href="https://developer.hashicorp.com/terraform/cli/commands/state/list"><code>terraform state list</code></a> command shows the resource addresses for every resource Terraform knows about in a configuration, optionally filtered by partial resource address.</p>
<p>These values are managed and stored in a <code>terraform.tfstate</code> file which is either stored locally or in a shared location (perhaps inside an S3 bucket that your team all have configured to connect to). I wonâ€™t get into all the details that surround how to handle state (shared or otherwise); for that, see chapter 3 of Brikmanâ€™s excellent <em><a href="https://www.terraformupandrunning.com">Terraform Up &amp; Running</a></em>.</p>
<p>The CLI command is your way to access information about resources without needing to wade through the raw state file itself, and might be interesting to inspect at some point once you have something deployed.</p>
</section>
<section id="graphing-your-infrastructure" class="level2">
<h2 class="anchored" data-anchor-id="graphing-your-infrastructure">ğŸ“ˆ Graphing your infrastructure</h2>
<p>To view a diagram of the infrastructure defined in your code, run the following:</p>
<pre class="shell"><code>terraform graph -draw-cycles | dot -Tpng &gt; graph.png</code></pre>
<p>Youâ€™ll probably also need <a href="https://graphviz.org/download/">Graphviz</a> to be installed for this to work.</p>
<p>This will create a PNG file which allows you to visualise the infrastructure defined in all your terraform code. For simple deployments this can be useful, but in my case this was less useful, as you can see from the following section of the image:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/partial-terraform-graph.png" class="img-fluid figure-img"></p>
<figcaption>Part of a terraform graph output</figcaption>
</figure>
</div>
<p>As with all these things, try it out and see if it works for you. You can also just export the data in other formats and manipulate them using your preferred graph data structure visualisation tools.</p>
<p>You can also use something like the <a href="https://github.com/pcasteran/terraform-graph-beautifier">terraform graph beautifier</a> to make it more comprehensible.</p>
</section>
<section id="auto-generated-deployment-documentation" class="level2">
<h2 class="anchored" data-anchor-id="auto-generated-deployment-documentation">ğŸ“„ Auto-generated deployment documentation</h2>
<p>If youâ€™re lucky and whoever wrote the terraform code has taken care to write descriptions for variables and the various modules being used, the next tool might prove quite useful. <a href="https://terraform-docs.io"><code>terraform-docs</code></a> is a way to generate module documentation via a CLI command. Once youâ€™ve installed it, running the following will give you a markdown file that you can preview to learn more about your codebase:</p>
<pre class="shell"><code>terraform-docs markdown . --output-file docs.md</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/terraform-docs-output.png" class="img-fluid figure-img"></p>
<figcaption>An example of output from terraform-docs</figcaption>
</figure>
</div>
<p>The file that gets output links to the code and underlying files, so itâ€™s a handy way to sort through exactly what is defined from your root module. Iâ€™ve personally found this to be really useful and itâ€™s even more so if the <code>description</code> parameters are defined.</p>
</section>
</section>
<section id="onwards" class="level1">
<h1>Onwards!</h1>
<p>I wrote this mostly as a reference and an excuse to learn about the topic myself. I hope it might be useful for someone else who is diving into a new codebase without much terraform experience. If you have any other tips or experience with this, please do use the comments below to make those suggestions!</p>
<p>[Many thanks to <a href="https://www.linkedin.com/in/suvash/">Suvash</a>, <a href="https://www.linkedin.com/in/wjayesh/">Jayesh</a>, and the commenters over on <a href="https://www.reddit.com/r/Terraform/comments/115jonp/how_to_understand_existing_code/">this invaluable reddit thread</a> for ideas and guidance.]</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/alexstrick\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="strickvl/mlops-dot-systems" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>