<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex Strick van Linschoten">
<meta name="dcterms.date" content="2022-05-24">
<meta name="description" content="I show you why you probably want to be versioning your data alongside your code. I introduce the basic functionality of DVC, the industry-standard tool for data versioning. I also explain specifically how I‚Äôm using DVC for my computer vision project.">

<title>More Data, More Problems: Using DVC to handle data versioning for a computer vision problem ‚Äì Alex Strick van Linschoten</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer="" data-domain="alexstrick.com" src="https://plausible.io/js/script.js"></script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="More Data, More Problems: Using DVC to handle data versioning for a computer vision problem ‚Äì Alex Strick van Linschoten">
<meta property="og:description" content="I show you why you probably want to be versioning your data alongside your code. I introduce the basic functionality of DVC, the industry-standard tool for data versioning. I also explain specifically how I‚Äôm using DVC for my computer vision project.">
<meta property="og:image" content="https://alexstrick.com/posts/dvc/dvclogo.png">
<meta property="og:site_name" content="Alex Strick van Linschoten">
<meta property="og:image:height" content="281">
<meta property="og:image:width" content="500">
<meta name="twitter:title" content="More Data, More Problems: Using DVC to handle data versioning for a computer vision problem ‚Äì Alex Strick van Linschoten">
<meta name="twitter:description" content="I show you why you probably want to be versioning your data alongside your code. I introduce the basic functionality of DVC, the industry-standard tool for data versioning. I also explain specifically how I‚Äôm using DVC for my computer vision project.">
<meta name="twitter:image" content="https://alexstrick.com/posts/dvc/dvclogo.png">
<meta name="twitter:creator" content="@strickvl">
<meta name="twitter:image-height" content="281">
<meta name="twitter:image-width" content="500">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Alex Strick van Linschoten</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Technical</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../personal.html"> 
<span class="menu-text">Personal</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../til.html"> 
<span class="menu-text">TIL</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/strickvl"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sigmoid.social/web/@alexstrick"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/strickvl"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rss" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">RSS</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-rss">    
        <li>
    <a class="dropdown-item" href="../index.xml">
 <span class="dropdown-text">Technical RSS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../personal.xml">
 <span class="dropdown-text">Personal RSS</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">More Data, More Problems: Using DVC to handle data versioning for a computer vision problem</h1>
                  <div>
        <div class="description">
          I show you why you probably want to be versioning your data alongside your code. I introduce the basic functionality of DVC, the industry-standard tool for data versioning. I also explain specifically how I‚Äôm using DVC for my computer vision project.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">tools</div>
                <div class="quarto-category">redactionmodel</div>
                <div class="quarto-category">computervision</div>
                <div class="quarto-category">mlops</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Alex Strick van Linschoten </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 24, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tldr-data-versioning-for-computer-vision" id="toc-tldr-data-versioning-for-computer-vision" class="nav-link active" data-scroll-target="#tldr-data-versioning-for-computer-vision">üö¶ TL;DR: Data Versioning for Computer Vision</a></li>
  <li><a href="#why-do-we-need-data-versioning-isnt-git-enough" id="toc-why-do-we-need-data-versioning-isnt-git-enough" class="nav-link" data-scroll-target="#why-do-we-need-data-versioning-isnt-git-enough">ü§î Why do we need data versioning? Isn‚Äôt <code>git</code> enough?</a></li>
  <li><a href="#dvc-use-cases" id="toc-dvc-use-cases" class="nav-link" data-scroll-target="#dvc-use-cases">üë©‚Äçüíª DVC Use Cases</a></li>
  <li><a href="#how-to-get-started-with-dvc" id="toc-how-to-get-started-with-dvc" class="nav-link" data-scroll-target="#how-to-get-started-with-dvc">üöÄ How to get started with DVC</a></li>
  <li><a href="#when-to-use-dvc" id="toc-when-to-use-dvc" class="nav-link" data-scroll-target="#when-to-use-dvc">üõ† When to use DVC</a></li>
  <li><a href="#how-im-using-dvc-in-my-redaction-project" id="toc-how-im-using-dvc-in-my-redaction-project" class="nav-link" data-scroll-target="#how-im-using-dvc-in-my-redaction-project">üìÑ How I‚Äôm using DVC in my redaction project</a></li>
  <li><a href="#appendix-how-to-switch-from-git-lfs-to-dvc" id="toc-appendix-how-to-switch-from-git-lfs-to-dvc" class="nav-link" data-scroll-target="#appendix-how-to-switch-from-git-lfs-to-dvc">üèÉ Appendix: How to switch from <code>git-lfs</code> to DVC</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><em>(This is part of a series of blog posts documenting my work to train a model that detects redactions in documents. To read other posts, check out <a href="https://mlops.systems/#category=redactionmodel">the <code>redactionmodel</code> taglist</a>.)</em></p>
<p>If you‚Äôve been following along as I train an object detection model to detect redactions, you‚Äôll know that there have been a few iterations in how I go about doing this. For the most part, though, the dataset has remained relatively static. I downloaded a huge tranche of publicly-released government documents right at the beginning and aside from <a href="https://mlops.systems/tools/redactionmodel/computervision/2022/04/06/synthetic-data-results.html">my experiments</a> in <a href="https://mlops.systems/redactionmodel/computervision/python/tools/2022/02/10/synthetic-image-data.html">synthetic data creation</a> I haven‚Äôt really been adding to this data.</p>
<p>When it comes to turning this model into something that can work <em>in production</em>, it won‚Äôt be enough to have a big bucket of image files that I train on. I‚Äôll need to have a bit more control and fine-grained segmentation of the ways this data is being used. In short, if I want to be able to reproduce my workflows then I need some kind of data versioning.</p>
<section id="tldr-data-versioning-for-computer-vision" class="level2">
<h2 class="anchored" data-anchor-id="tldr-data-versioning-for-computer-vision">üö¶ TL;DR: Data Versioning for Computer Vision</h2>
<ul>
<li>‚õΩÔ∏è We version our data because it is the fuel for our model development and experimentation process.</li>
<li>üíª Data versioning tools like DVC allow you to apply the same mental model you have for <code>git</code> to your data.</li>
<li>‚ãî The ability to ‚Äòbranch‚Äô off your data gives you the flexibility to experiment just as the same is true for branching off your code to try out some new behaviour.</li>
<li><a href="https://dvc.org/">DVC</a> is probably the leading tool that allows you to version your data and flexibly access all the previous ‚Äòcommits‚Äô and checkpoints you make along the way.</li>
</ul>
</section>
<section id="why-do-we-need-data-versioning-isnt-git-enough" class="level2">
<h2 class="anchored" data-anchor-id="why-do-we-need-data-versioning-isnt-git-enough">ü§î Why do we need data versioning? Isn‚Äôt <code>git</code> enough?</h2>
<p>If the lifeblood of traditional software engineering is code then the equivalent for machine learning is data. We solve the problem of checkpointing what our code looked like at a particular moment with <code>git</code> and online hubs like Github. Until recently there weren‚Äôt many equivalent options for data. We‚Äôre trying to solve the problem that often occurs if you‚Äôre asked to reproduce the data that was used to train a particular iteration of a model from some point in the past. Without some kind of data version control this is more or less impossible, particularly if your data is constantly changing.</p>
<p>Even in my case for this redaction project, I wasn‚Äôt ingesting new data all the time but I <em>was</em> removing bad annotations or updating those annotations as I conducted error analysis or <a href="https://mlops.systems/redactionmodel/computervision/tools/debugging/jupyter/2022/03/12/fiftyone-computervision.html">used tools like FiftyOne</a> to understand why my model wasn‚Äôt performing as well as I‚Äôd have liked.</p>
<p>Luckily there‚Äôs a pretty great tool in this space that seems to be more or less unchallenged for what it does in the data versioning domain: <a href="https://dvc.org">Data Version Control</a> or <a href="https://dvc.org">DVC</a>.</p>
</section>
<section id="dvc-use-cases" class="level2">
<h2 class="anchored" data-anchor-id="dvc-use-cases">üë©‚Äçüíª DVC Use Cases</h2>
<p>DVC does many things, but for our purposes at this moment its core value is that it helps us version our data. It also handles the case where we have large files or a dataset that changes a lot and where we might end up having problems with storing all the versions of this data.</p>
<p>The core behaviour we want to use with a data versioning tool is to access our data at one particular moment. Just like you incrementally annotate your code updates using <code>git</code>, with sometimes atomic progressions as you do your work, so it is with DVC that you can checkpoint your data as you make changes.</p>
<p>At the beginning this was a slight mental adjustment for me. When working on a project it is now second nature to regularly make <code>git</code> commits along the way, but I wasn‚Äôt in the habit of making regular data commits as a second step. In the long-run, this requires a bit of a mental shift but this is exactly what will enable the benefits that using a tool like DVC brings.</p>
<p>In particular, being able to experiment with data in a way that you can always roll-back from feels pretty liberating once you‚Äôve covered your back with DVC. Just as you can use create <code>git</code> branches for your code, so you can create branches for your versioned data. <a href="https://dvc.org/doc/command-reference/checkout">Checking out</a> the precise data used for some zany experiment you did is pretty painless. If you realise that the experiment is a dead-end and it‚Äôs not helping you move forward, just rewind and reset your data back to a useable state from before you had that crazy idea to create a million synthetic images :)</p>
<p>One other thing: DVC is built on top of <code>git</code> and it follows many of the mental models you might have about how versioning works. In this way, DVC luckily is smart about how it allows you to make incremental changes to your data. When it calculates the <code>diff</code> of your dataset before and after, it really is able to do some atomic updates and logging of what changed rather than just storing all the files multiple times over. This helps prevent you building up a really huge data cache and it helps the whole process be efficient.</p>
<p>{% include info.html text=‚ÄúI‚Äôve mentioned this for other tools like Evidently before so I should also note that the DVC online community (https://dvc.org/community) is a pretty friendly and helpful place to hang out and learn about data versioning or to troubleshoot your problems. Nobody will tell you to RTFM here and their community events are generally beginner-friendly in my experience. This makes a big difference so they should be commended for the efforts they take to foster this kind community atmosphere. ‚ù§Ô∏è‚Äù %}</p>
</section>
<section id="how-to-get-started-with-dvc" class="level2">
<h2 class="anchored" data-anchor-id="how-to-get-started-with-dvc">üöÄ How to get started with DVC</h2>
<p>The basics are mostly similar to how you‚Äôd use a tool like <code>git</code>:</p>
<ul>
<li>You <a href="https://dvc.org/doc/command-reference/init"><code>init</code></a> your repository. This add some DVC superpowers on top of what you already have with <code>git</code>.</li>
<li>You <a href="https://dvc.org/doc/command-reference/add">specify which files</a> you want to have DVC manage and track. It would make a lot of sense, for example, to have DVC handle tracking your models, your image files and your data annotations (if those exist as separate files).</li>
<li>You can optionally also <a href="https://dvc.org/doc/command-reference/remote">specify a <code>remote</code> location</a> where you want these files to be stored. (DVC supports several types of remote storage: local file system, SSH, Amazon S3, Google Cloud Storage, HTTP, HDFS, among others.)</li>
</ul>
<p>(To get a taste of the full workflow when using DVC for data tracking I‚Äôd recommend something like the basic tutorial they have <a href="https://dvc.org/doc/use-cases/versioning-data-and-model-files/tutorial">here</a>. They also <a href="https://dvc.org/blog/end-to-end-computer-vision-api-part-1-data-versioning-and-ml-pipelines">recently added a three-part tutorial</a> specific to computer vision that you might want to check out.)</p>
<p>If you want to use DVC programmatically using their Python API, you can get some information on this <a href="https://dvc.org/doc/api-reference">in their docs here</a>. Unfortunately, these docs are incomplete and you‚Äôll have to experiment a bit if you want to do anything beyond the simple functionality they themselves list. I‚Äôm told it behaves very similarly to how <a href="https://gitpython.readthedocs.io/en/stable/intro.html">a tool like GitPython</a> works, where you can just use the equivalent <code>add()</code> or <code>checkout()</code> function call that corresponds to a DVC CLI command, but given the lack of documentation it‚Äôs a bit harder to get a full sense of what is possible.</p>
<p>{% include alert.html text=‚ÄúDVC includes a lot of extra functionality around experiment tracking and pipelining of your code. You can safely ignore all that and just use DVC for data versioning. No shame in that :)‚Äù %}</p>
</section>
<section id="when-to-use-dvc" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-dvc">üõ† When to use DVC</h2>
<p>It probably is a good practice to use something like DVC from the start of most projects. If you know you‚Äôre never going to need to update the data you use, or if you will only ever generate one model, then maybe you have no need for data versioning. But realistically, when are you going to do that? Generally speaking you‚Äôll be iterating a lot and you‚Äôll be trying things out, so perhaps just start using DVC at the start of any new project: a <code>git init</code> can just as easily be followed by a <code>dvc init</code>‚Ä¶</p>
<p>DVC will thrive in long-lived projects where you go down certain rabbit-holes, trying out different approaches and techniques. If you have a decent amount of data ‚Äî and you probably do if you‚Äôre bringing deep learning to the table ‚Äî then you can leverage how DVC makes it easy to store your data in the remote infrastructure of your choice with <a href="https://dvc.org/doc/command-reference/remote"><code>dvc remote</code></a>.</p>
</section>
<section id="how-im-using-dvc-in-my-redaction-project" class="level2">
<h2 class="anchored" data-anchor-id="how-im-using-dvc-in-my-redaction-project">üìÑ How I‚Äôm using DVC in my redaction project</h2>
<p>For my purposes, the things I‚Äôm tracking with DVC include:</p>
<ul>
<li>the models I train</li>
<li>the PDF documents I downloaded from public sources that form the basis of the data in this project</li>
<li>the images that I extracted from the PDF documents</li>
<li>the annotations I make on the images using <a href="https://cocodataset.org/">the standard COCO Dataset format</a>.</li>
</ul>
<p>This covers the core data that I expect to be working with for this project. I keep all this data synced to a remote Amazon S3 bucket which allows me to easily get set up on a new remote machine if needed.</p>
<p>I‚Äôll next be writing about how to move towards a ‚Äòproduction-ready‚Äô system in the coming weeks, but one thing I‚Äôll hope to be adding to the current way I do things is to add some kind of <a href="https://github.com/PAIR-code/datacardsplaybook">‚Äòdata cards‚Äô</a>. I think a combination of manual comments and annotations alongside some auto-generated data profiles would be a useful thing to get a sense of for every checkpoint we make, particularly as the data grows and is augmented.</p>
<p>Let me know if you‚Äôre using DVC to version your data for computer vision projects! I‚Äôm curious if there are any tricks I‚Äôm missing out‚Ä¶</p>
</section>
<section id="appendix-how-to-switch-from-git-lfs-to-dvc" class="level2">
<h2 class="anchored" data-anchor-id="appendix-how-to-switch-from-git-lfs-to-dvc">üèÉ Appendix: How to switch from <code>git-lfs</code> to DVC</h2>
<p>When I first started this project, <a href="https://git-lfs.github.com"><code>git-lfs</code></a> or Git Large File Storage seemed the best option that didn‚Äôt constrain my choices. It allowed me to store any large files I had inside my repository and allowed for some sort of versioning. Over time this ended up being less robust, especially in the context of an ML workflow, so I decided to switch to using DVC backed by an Amazon S3 bucket.</p>
<p>I didn‚Äôt find any useful information on the DVC website or forums on how to make this switch so I‚Äôm including my notes on how I switched over myself.</p>
<p>{% include alert.html text=‚ÄúLots of caution is advised when doing this for your own project or work. I hit some major roadblocks along the way while doing this owing to some quirks of how I‚Äôd set ‚Äògit-lfs‚Äô up in the beginning. Please take all necessary backups and snapshots of your data in case something goes wrong along the way!‚Äù %}</p>
<p>Some resources I consulted to understand how to do this:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/35011366/move-git-lfs-tracked-files-under-regular-git/54119191#54119191">This Stackoverflow thread</a></li>
<li><a href="https://github.com/git-lfs/git-lfs/issues/3026">A Github issue</a> on the same topic</li>
<li><a href="https://gist.github.com/everttrollip/198ed9a09bba45d2663ccac99e662201">A super useful Gist</a> I reached via the previous Github issue that ended up guiding me most of the way</li>
</ul>
<p>This is what I did, step by step:</p>
<ul>
<li>Commit and push everything to Git / Github / <code>git-lfs</code></li>
<li>Create a branch, something like <code>fix/remove-lfs</code></li>
<li>Remove the hooks using <code>git las uninstall</code></li>
<li>Go into the <code>.gitattributes</code> file and delete whatever tracking you don‚Äôt want <code>git-lfs</code> to handle from now on. For me, this involved removing lines referring to <code>.pth</code> (model) files and <code>.jpg</code> (image) files.</li>
<li>Get a list of all the files that <code>git-lfs</code> currently is storing using the following command: <code>git lfs ls-files &gt; files.txt</code></li>
<li>Modify the file to remove the beginnings of each line that we don‚Äôt need. At the end we want our <code>files.txt</code> to contain just a series of paths to our files. I did it with a simple Python script:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"filenames.txt"</span>, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    f.write(<span class="st">""</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"files.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> f2:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> f2:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"filenames.txt"</span>, <span class="st">"a"</span>) <span class="im">as</span> f:</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            f.write(line.split(<span class="st">" "</span>)[<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Run <code>run git rm --cached</code> for each file that <code>git-lfs</code> is storing. I did this with a simple bash command that uses the file I‚Äôd created in the previous step:</li>
</ul>
<pre class="shell"><code>while read line; do git rm --cached "$line"; done &lt; files.txt</code></pre>
<ul>
<li>Initialise the DVC repository with <code>dvc init</code></li>
<li>Add whatever data sources you want tracked (<code>dvc add FOLDERNAME</code>)</li>
<li>Allow for autostaging with DVC with the <code>dvc config core.autostage true</code> command</li>
<li>Commit everything</li>
<li>Check that no <code>git-lfs</code> files are left with the <code>git lfs ls-files</code> command. Whatever you uncached in previous steps should not show up any more.</li>
<li>Remove any lfs with <code>rm -rf .git/lfs</code></li>
<li>Merge your branch into <code>main</code>
<ul>
<li>(if you‚Äôre using <code>git-lfs</code> as a team, now is probably the time when other collaborators can uninstall git-lfs as specified above)</li>
</ul></li>
<li>If needed, add your DVC remote storage with <code>dvc remote add ‚Ä¶</code> (<a href="https://dvc.org/doc/command-reference/remote">consult the docs</a> for exactly how to set this up for your specific needs)</li>
<li><code>dvc push</code> to get your files synced with your remote storage</li>
</ul>
<p>At this point you should be fully transitioned over. As I mentioned above, there are a ton of weird edge cases and quirks to this process and you probably shouldn‚Äôt follow this list blindly. I‚Äôm mainly writing this up for my own records as much as anything else, so perhaps it‚Äôs helpful for someone else seeking to transition but maybe it should be taken less as a direct list of instructions than an inspiration or general template. (I wish DVC would provide some official-ish guidance on this process through their documentation. I imagine that it‚Äôs a fairly common path for someone to outgrow <code>git-lfs</code> and want to get going with DVC but currently there are no instructions for how to think this through.)</p>
<p>UPDATE: <em>I originally made reference to ‚Äòcontinuous training‚Äô in the title of this blogpost but I didn‚Äôt actually get into this specific use case in what I covered, so I took that out of the title and we‚Äôll save the specifics for a subsequent post!</em></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/alexstrick\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>